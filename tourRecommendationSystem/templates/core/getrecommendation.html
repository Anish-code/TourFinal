{% extends "partials/base.html" %} {% load static %} {% block content %}

<h1>Get Recommendations</h1>
<!-- getrecommendation.html -->

<form id="recommendationsForm" style="padding: 40px">
  <label for="location" style="font-size: 50px"
    >Select Location for getting recommendation :</label
  ><br />
  <select
    id="location"
    name="location"
    required
    style="
      width: 53rem;
      border-radius: 17px;
      font-size: 28px;
      background: darkgray;
      padding: 9px;
      margin-top: 10px;
    "
  >
    {% for location in locations %}
    <option value="{{location.ID}}">{{location.location}}</option>
    {% endfor %}
    <!-- Dropdown options will be dynamically populated here -->
  </select>
  <br />
  <button type="submit">Get Recommendations</button>
</form>
<div id="recommendationsContainer">
  <!-- Recommendations will be displayed here -->
</div>
<script>
  fetch("tourdatas.csv")
    .then((response) => response.text())
    .then((data) => {
      // Split CSV data into array of lines
      const lines = data.split("\n");
      // Remove header line
      const header = lines.shift();
      // Get index of 'location' column
      const locationIndex = header.split(",").indexOf("location");
      // Extract unique locations
      const locations = new Set();
      lines.forEach((line) => {
        // Split each line into fields
        const fields = line.split(",");
        // Add location to set
        locations.add(fields[locationIndex].trim());
      });
      // Populate dropdown options
      const dropdown = document.getElementById("location");
      locations.forEach((location) => {
        // Create option element
        const option = document.createElement("option");
        option.value = location;
        option.textContent = location;
        // Append option to dropdown
        dropdown.appendChild(option);
      });
    })
    .catch((error) => console.error("Error fetching CSV:", error));
  document
    .getElementById("recommendationsForm")
    .addEventListener("submit", function (event) {
      event.preventDefault();
      var itemId = document.getElementById("location").value;
      getRecommendations(itemId);
    });

  function getRecommendations(itemId) {
    fetch(`/get_recommendation/${itemId}/`)
      .then((response) => response.json())
      .then((data) => {
        displayRecommendations(data.recommendations);
      })
      .catch((error) => console.error("Error:", error));
  }

  function displayRecommendations(recommendations) {
    var recommendationsContainer = document.getElementById(
      "recommendationsContainer"
    );
    recommendations = JSON.parse(recommendations);
    recommendationsContainer.innerHTML = "<h2>Recommendations:</h2>";
    var ul = document.createElement("div");
    ul.classList = "row";
    console.log(recommendations);
    recommendations.forEach(function (recommendation) {
      ul.innerHTML += `<div class="col-lg-4 col-md-6">
        <div
          class="single_explore mt-30 wow fadeIn"
          data-wow-duration="1.3s"
          data-wow-delay="0.8s"
          style="
            visibility: visible;
            animation-duration: 1.3s;
            animation-delay: 0.8s;
            animation-name: fadeIn;
          "
        >
          <div class="explore_image">
            <img src="${recommendation["image1"]}" alt="NEPAL" />
          </div>
          <div class="explore_content">
            <a class="main-btn">Get Details</a>
            <h4 class="title"><a>${recommendation["location"]}</a></h4>
          </div>
        </div>
      </div>
      `;

      //ul.appendChild(h1);
      //ul.appendChild(img);
    });
    recommendationsContainer.appendChild(ul);
  }
</script>
{% endblock content %}
